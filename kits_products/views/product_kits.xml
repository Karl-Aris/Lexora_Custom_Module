<odoo>
    <template id="kit_group_detail_template" name="Kit Group Detail">
        <t t-call="website.layout">
            <div class="container py-5">

                <div class="row g-5">
                    <!-- Left Column: Main Product -->
                    <div class="col-lg-6">
                        <t t-if="kit">
                            <t t-if="product">
                                <p class="text-muted small">/                                    <t t-esc="product.name" />
                                </p>
                                <div class="text-center mb-4">
                                    <img t-att-src="'/web/image/product.product/' + str(product.id) + '/image_1920'" alt="Product Image" class="img-fluid rounded shadow-sm" style="height: 400px; object-fit: cover;" />
                                </div>
                                <h5 class="fw-semibold mb-1 text-start">
                                    <t t-esc="product.name" />
                                </h5>
                                <p class="text-muted small text-center mb-2">
                                    <t t-esc="product.description_sale" />
                                </p>
                                <p class="fs-5 fw-semibold text-start">Price: <t t-esc="product.lst_price and ('%.2f' % product.lst_price) or 'N/A'" />
                                </p>
                            </t>

                            <t t-if="kit.product_id">
                                <form action="/shop/cart/update" method="post" class="mt-4">
                                    <input type="hidden" name="product_id" t-att-value="kit.product_id.id" />
                                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()" />

                                    <div class="d-flex flex-row align-items-center gap-3 flex-wrap ">
                                        <div class="input-group" style="max-width: 180px;">
                                            <button type="button" class="btn btn-outline-secondary" data-qty-delta="-1">âˆ’</button>
                                            <input name="add_qty" type="number" class="form-control text-center" value="1" min="1" />
                                            <button type="button" class="btn btn-outline-secondary" data-qty-delta="1">+</button>
                                        </div>

                                      <button type="submit" class="btn btn-dark fw-semibold d-flex align-items-center justify-content-center shadow-sm" style=" width: 300px; height: 40px;">
  <i class="fa fa-cart-plus me-2"></i> Add to Cart
</button>
                                    </div>

                                </form>
                            </t>
                            <t t-else="">
                                <p class="text-danger text-center mt-3">Product not available for sale</p>
                            </t>
                        </t>
                        <t t-else="">
                            <p class="text-muted">No matching kit found for this selection.</p>
                        </t>
                    </div>

                    <!-- Right Column: Components -->
                    <div class="col-lg-6">
                        <!-- Cabinet Sizes -->
                        <t t-if="related_kits">
                            <t t-set="shown_sizes" t-value="[]" />

                            <div class="mb-4">
                                <h4 class="mb-3 fw-bold border-bottom pb-2 text-primary">
                                    <i class="fa fa-expand-arrows-alt me-1"></i>
                                    <span class="d-inline-flex align-items-center justify-content-center bg-black text-white rounded-circle" style="width: 30px; height: 30px; font-size: 14px;">
  1
                                    </span>


        Select Cabinet Size
                                </h4>

                                <div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-5 g-3">
                                    <t t-foreach="related_kits" t-as="rel_kit">
                                        <t t-if="rel_kit.size not in shown_sizes">
                                            <t t-set="shown_sizes" t-value="shown_sizes + [rel_kit.size]" />
                                            <div class="col">
                                                <div class="card h-100 border-0 shadow-sm text-center">
                                                    <a t-att-href="'/product_kits/group?collection=%s&amp;size=%s' % (rel_kit.collection or '', rel_kit.size or '')">
                                                        <div class="d-flex justify-content-center align-items-center p-2" style="height: 120px;">
                                                            <img t-att-src="'/web/image/product.product/' + str(rel_kit.product_id.id) + '/image_1920'" class="img-fluid rounded" style="max-height: 100px; object-fit: cover;" alt="Size Image" />
                                                        </div>
                                                    </a>
                                                    <div class="card-body p-2">
                                                        <h6 class="mb-0">
                                                            <a t-att-href="'/product_kits/group?collection=%s&amp;size=%s' % (rel_kit.collection or '', rel_kit.size or '')" class="text-decoration-none text-dark">
                                                                <t t-esc="rel_kit.size" />
                                                            </a>
                                                        </h6>
                                                    </div>
                                                </div>
                                            </div>
                                        </t>
                                    </t>
                                </div>
                            </div>
                        </t>

                        <!-- Components Section -->
                        <t t-foreach="['cabinet', 'counter_top', 'mirror', 'faucet']" t-as="category">
                            <t t-if="components[category]">
                                <div class="mb-5">
                                    <div class="d-flex justify-content-between align-items-center mb-3 border-bottom pb-2">
                                        <h4 class="mb-0 fw-semibold">
                                            <t t-if="category == 'cabinet'">
                                                <span class="d-inline-flex align-items-center justify-content-center bg-black text-white rounded-circle" style="width: 30px; height: 30px; font-size: 14px;">
  2
                                                </span>
 Color</t>
                                            <t t-if="category == 'counter_top'">
                                                <span class="d-inline-flex align-items-center justify-content-center bg-black text-white rounded-circle" style="width: 30px; height: 30px; font-size: 14px;">
3
                                                </span>
 Counter Top</t>
                                            <t t-if="category == 'mirror'">
                                                <span class="d-inline-flex align-items-center justify-content-center bg-black text-white rounded-circle" style="width: 30px; height: 30px; font-size: 14px;">
  4
                                                </span>
 Mirror</t>
                                            <t t-if="category == 'faucet'">
                                                <span class="d-inline-flex align-items-center justify-content-center bg-black text-white rounded-circle" style="width: 30px; height: 30px; font-size: 14px;">
 5
                                                </span>
 Faucet</t>
                                        </h4>
                                        <t t-if="(category == 'cabinet' and cabinet) or (category == 'counter_top' and counter_top) or (category == 'mirror' and mirror) or (category == 'faucet' and faucet)">
                                            <a t-att-href="'/product_kits/group?collection=%s&amp;size=%s&amp;cabinet=%s&amp;counter_top=%s&amp;mirror=%s&amp;faucet=%s' % (
                                            collection, size or '',
                                            ('' if category == 'cabinet' else cabinet or ''),
                                            ('' if category == 'counter_top' else counter_top or ''),
                                            ('' if category == 'mirror' else mirror or ''),
                                            ('' if category == 'faucet' else faucet or '')
                                        )" class="btn btn-sm btn-outline-danger">Unselect</a>
                                        </t>
                                    </div>

                                    <div class="row g-3">
                                        <t t-foreach="components[category]" t-as="comp">
                                            <div class="col-6 col-sm-4 col-lg-3">
                                                <a t-att-href="'/product_kits/group?collection=%s&amp;size=%s&amp;cabinet=%s&amp;counter_top=%s&amp;mirror=%s&amp;faucet=%s' % (
                                                collection, size or '',
                                                ('' if category == 'cabinet' and cabinet == comp.id else (comp.id if category == 'cabinet' else cabinet or '')),
                                                ('' if category == 'counter_top' and counter_top == comp.id else (comp.id if category == 'counter_top' else counter_top or '')),
                                                ('' if category == 'mirror' and mirror == comp.id else (comp.id if category == 'mirror' else mirror or '')),
                                                ('' if category == 'faucet' and faucet == comp.id else (comp.id if category == 'faucet' else faucet or ''))
                                            )" class="text-decoration-none">
                                                    <div t-attf-class="card h-100 rounded-3 #{'border border-primary shadow' if ((category == 'cabinet' and comp.id == cabinet) or (category == 'counter_top' and comp.id == counter_top) or (category == 'mirror' and comp.id == mirror) or (category == 'faucet' and comp.id == faucet)) else 'border-light shadow-sm'}" style="transition: transform 0.2s; cursor: pointer;" onmouseover="this.style.transform='scale(1.03)';" onmouseout="this.style.transform='scale(1)';">
                                                        <div class="d-flex justify-content-center align-items-center p-2" style="height: 120px;">
                                                            <img t-att-src="comp.image_1920 and '/web/image/product.product/' + str(comp.id) + '/image_1920' or ''" class="img-fluid rounded" style="max-height: 100px; object-fit: cover;" />
                                                        </div>
                                                        <div class="card-body p-2 text-center">
                                                            <small class="text-muted d-block">
                                                                <t t-esc="comp.default_code or 'No SKU'" />
                                                            </small>
                                                        </div>
                                                    </div>
                                                </a>
                                            </div>
                                        </t>
                                    </div>
                                </div>
                            </t>
                        </t>
                    </div>
                </div>

                <!-- Reset Button -->
                <div class="mt-4 text-end">
                    <a t-att-href="'/product_kits/group?collection=%s&amp;size=%s' % (collection, size or '')" class="btn btn-outline-secondary">Reset Selection</a>
                </div>
            </div>

            <!-- Quantity Button Script -->
            <t t-set="scripts">
                <t t-raw="0">
                    <![CDATA[
<script>
    document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('button[data-qty-delta]').forEach(btn => {
            btn.addEventListener('click', () => {
                const input = btn.closest('.input-group').querySelector('input[name="add_qty"]');
                if (input) {
                    let val = parseInt(input.value) || 1;
                    input.value = Math.max(1, val + parseInt(btn.dataset.qtyDelta));
                }
            });
        });
    });
</script>
                ]]>
                </t>
            </t>
        </t>
    </template>


</odoo>