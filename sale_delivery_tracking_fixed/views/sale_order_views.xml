<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- Extend Sales Order form to add Delivery Tracking page -->
    <record id="view_order_form_delivery_tracking" model="ir.ui.view">
        <field name="name">sale.order.delivery.tracking.form</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="arch" type="xml">
            <xpath expr="//sheet/notebook" position="inside">
                <page string="Delivery Tracking">
                    <group>
                        <group>
                            <field name="delivery_status"/>
                            <field name="etd"/>
                            <field name="actual_delivery_date"/>
                        </group>
                        <group>
                            <field name="follow_up_required"/>
                            <field name="contacted"/>
                            <field name="contact_notes"/>
                        </group>
                    </group>
                </page>
            </xpath>
        </field>
    </record>

    <!-- Add 9 custom filters to Sales Orders search view -->
    <record id="view_sale_order_filters_delivery_tracking" model="ir.ui.view">
        <field name="name">sale.order.delivery.tracking.filters</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_quotation_filter"/>
        <field name="arch" type="xml">
            <xpath expr="//search" position="inside">

                <!-- 1) ETD Missing -->
                <filter string="ETD Missing" name="etd_missing"
                    domain="['|', ('delivery_status', '=', False), ('delivery_status', '=', 'not_delivered'), ('etd', '=', False), ('carrier_tracking_ref', '!=', False), ('carrier_id', '!=', False)]"/>

                <!-- 2) Missed ETD – Not Delivered -->
                <filter string="Missed ETD - Not Delivered" name="missed_etd_not_delivered"
                    domain="[('etd', '&lt;', context_today()), ('delivery_status', '=', 'not_delivered'), ('carrier_tracking_ref', '!=', False), ('carrier_id', '!=', False)]"/>

                <!-- 3) Same-Day ETD – Not Delivered Yet -->
                <filter string="Same-Day ETD - Not Delivered Yet" name="same_day_etd_not_delivered"
                    domain="[('etd', '=', context_today()), ('delivery_status', '=', 'not_delivered'), ('carrier_tracking_ref', '!=', False), ('carrier_id', '!=', False)]"/>

                <!-- 4) Delivered – Not Contacted -->
                <filter string="Delivered - Not Contacted" name="delivered_not_contacted"
                    domain="[('delivery_status', '=', 'delivered'), ('contacted', '=', False), ('carrier_tracking_ref', '!=', False), ('carrier_id', '!=', False)]"/>

                <!-- 5) Delivered – Contacted but Notes Present -->
                <filter string="Delivered - Contacted w/ Notes" name="delivered_contacted_notes"
                    domain="[('delivery_status', '=', 'delivered'), ('contacted', '!=', False), ('contact_notes', '!=', False)]"/>

                <!-- 6) Follow-Up Required – Open -->
                <filter string="Follow-Up Required - Open" name="follow_up_required_open"
                    domain="[('follow_up_required', '=', True), '|', ('delivery_status', '!=', 'delivered'), ('contacted', '=', False)]"/>

                <!-- 7) Actual Delivery Date Missing (but Delivered) -->
                <filter string="Actual Delivery Date Missing" name="actual_delivery_date_missing"
                    domain="[('delivery_status', '=', 'delivered'), ('actual_delivery_date', '=', False)]"/>

                <!-- 8) Delivery Status Missing (after shipping info present) -->
                <filter string="Delivery Status Missing" name="delivery_status_missing"
                    domain="[('delivery_status', '=', False), ('carrier_tracking_ref', '!=', False), ('carrier_id', '!=', False)]"/>

                <!-- 9) ETD Today & Delivered but Not Contacted -->
                <filter string="ETD Today &amp; Delivered, Not Contacted" name="etd_today_delivered_not_contacted"
                    domain="[('etd', '=', context_today()), ('delivery_status', '=', 'delivered'), ('contacted', '=', False), ('carrier_tracking_ref', '!=', False), ('carrier_id', '!=', False)]"/>
            </xpath>
        </field>
    </record>
</odoo>
