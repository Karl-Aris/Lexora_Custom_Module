<odoo>
  <template id="template_product_configuration" name="Product Configuration">
    <t t-call="website.layout">
      <div class="container my-4">

        <!-- Collection Dropdown -->
        <div class="mb-4">
          <label for="collection_select" class="form-label">Select Collection</label>
          <select id="collection_select" class="form-select" name="collection" onchange="location = this.value;">
            <option t-if="not selected_collection" selected="selected" disabled="disabled">Select collection</option>
            <t t-foreach="collections" t-as="col">
              <option t-att-value="'/store?collection=%s' % col" t-att-selected="col == selected_collection">
                <t t-esc="col"/>
              </option>
            </t>
          </select>
        </div>

        <!-- Color Badges -->
        <t t-if="colors">
          <div class="mb-4">
            <strong>Colors:</strong>
            <t t-foreach="colors" t-as="color">
              <a t-att-href="'/store?collection=%s%s' % (
                      selected_collection,
                      '&amp;color=' + color if selected_color != color else ''
                    )"
                 t-att-class="'badge rounded-pill me-2 px-3 py-2 ' + ('bg-secondary text-white' if color == selected_color else 'bg-light text-dark')"
                 style="cursor:pointer;">
                <t t-esc="color"/>
              </a>
            </t>
          </div>
        </t>

        <!-- Show rest only if collection selected -->
        <t t-if="selected_color">
          <div class="row">
            <!-- LEFT COLUMN: Configured image or cabinet fallback -->
            <div class="col-md-6">
              <t t-if="selected_sku">
                <!-- Load the cabinet product -->
                <t t-set="cabinet_product"
                  t-value="request.env['product.product'].sudo().search([('default_code', '=', selected_sku)], limit=1)" />

                <!-- Show configured product if a valid combination exists -->
                <t t-if="configured_product and configured_product.image_1920">
                  <img t-att-src="'data:image/png;base64,%s' % configured_product.image_1920.decode('utf-8')"
                      alt="Configured Product"
                      class="img-thumbnail"
                      style="width: 100%; height: 500px; object-fit: contain;" />
                  <div class="mt-2 text-center">
                    <strong t-esc="configured_product.name or 'Unnamed Product'" /><br />
                    <small class="text-muted" t-esc="configured_product.default_code or ''" />
                  </div>
                </t>

                <!-- If no combination, show fallback cabinet image -->
                <t t-elif="cabinet_product and cabinet_product.image_1920">
                  <img t-att-src="'data:image/png;base64,%s' % cabinet_product.image_1920.decode('utf-8')"
                      alt="Cabinet"
                      class="img-thumbnail"
                      style="width: 100%; height: 500px; object-fit: contain;" />
                  <div class="mt-2 text-center">
                    <strong t-esc="cabinet_product.name or 'Unnamed Product'" /><br />
                    <small class="text-muted" t-esc="cabinet_product.default_code or ''" />
                  </div>
                </t>
              </t>
            </div>

            <!-- Right Column: Size Options -->
            <div class="col-md-6">
              <h4>Select Size</h4>
              <t t-foreach="size_cards" t-as="size_card">
                <div class="d-flex align-items-center">
                  <img t-att-src="'data:image/png;base64,%s' % size_card.image" class="img-thumbnail" style="width: 100px; height: 100px; object-fit: contain;" />
                  <div class="ms-3">
                    <span class="badge rounded-pill bg-light text-dark" t-esc="size_card.size" />
                  </div>
                </div>
              </t>
            </div>
          </div>
        </t>

      </div>
    </t>
  </template>
</odoo>
