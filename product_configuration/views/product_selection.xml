<odoo>
  <template id="template_product_configuration" name="Product Configuration">
    <t t-call="website.layout">
      <div class="container my-4">
        <!-- Collection Dropdown -->
        <div class="mb-4">
          <label for="collection_select" class="form-label">Select Collection</label>
          <select id="collection_select" class="form-select" name="collection" onchange="updateURL('collection', this.value)">
            <option t-if="not selected_collection" selected="selected" disabled="disabled">Select collection</option>
            <t t-foreach="collections" t-as="col">
              <option t-att-value="col" t-att-selected="col == selected_collection">
                <t t-esc="col"/>
              </option>
            </t>
          </select>
        </div>

        <!-- Color Badges -->
        <t t-if="selected_collection and colors">
          <div class="mb-4">
            <strong>Colors:</strong>
            <div class="btn-group" role="group">
              <t t-foreach="colors" t-as="color">
                <button type="button" class="btn btn-outline-secondary" 
                        onclick="updateURL('color', '<t t-esc='color'/>')">
                  <t t-esc="color"/>
                </button>
              </t>
            </div>
          </div>
        </t>

        <!-- Step 1: Size Selection -->
        <t t-if="selected_collection and selected_color">
          <div class="mb-4">
            <strong>Select Size:</strong>
            <div class="row">
              <t t-foreach="size_cards" t-as="card">
                <div class="col-3 mb-3">
                  <button type="button" class="btn btn-outline-secondary"
                          onclick="updateURL('cabinet_sku', '<t t-esc='card['cabinet_sku']'/>')">
                    <t t-if="card['image']">
                      <img t-att-src="'data:image/png;base64,%s' % card['image']" class="img-fluid" style="height: 80px; object-fit: cover;" alt="Product Image"/>
                    </t>
                    <t t-else="">
                      <div class="bg-light text-center" style="height: 80px;">No Image</div>
                    </t>
                    <br/>
                    <strong><t t-esc="card['size']"/></strong><br/>
                    <small><t t-esc="card['cabinet_sku']"/></small>
                  </button>
                </div>
              </t>
            </div>
          </div>
        </t>

        <!-- Step 2: Counter Top Selection -->
        <t t-if="selected_collection and selected_color and cabinet_sku">
          <div class="mb-4">
            <strong>Select Countertop:</strong>
            <div class="row">
              <t t-foreach="counter_top_cards" t-as="card">
                <div class="col-3 mb-3">
                  <button type="button" class="btn btn-outline-secondary"
                          onclick="updateURL('counter_top_sku', '<t t-esc='card['counter_top_sku']'/>')">
                    <strong><t t-esc="card['counter_top']"/></strong><br/>
                    <small><t t-esc="card['counter_top_sku']"/></small>
                  </button>
                </div>
              </t>
            </div>
          </div>
        </t>

        <!-- Step 3: Mirror Selection -->
        <t t-if="selected_collection and selected_color and cabinet_sku">
          <div class="mb-4">
            <strong>Select Mirror:</strong>
            <div class="row">
              <t t-foreach="mirror_cards" t-as="card">
                <div class="col-3 mb-3">
                  <button type="button" class="btn btn-outline-secondary"
                          onclick="updateURL('mirror_sku', '<t t-esc='card['mirror_sku']'/>')">
                    <strong><t t-esc="card['mirror']"/></strong><br/>
                    <small><t t-esc="card['mirror_sku']"/></small>
                  </button>
                </div>
              </t>
            </div>
          </div>
        </t>

        <!-- Step 4: Faucet Selection -->
        <t t-if="selected_collection and selected_color and cabinet_sku">
          <div class="mb-4">
            <strong>Select Faucet:</strong>
            <div class="row">
              <t t-foreach="faucet_cards" t-as="card">
                <div class="col-3 mb-3">
                  <button type="button" class="btn btn-outline-secondary"
                          onclick="updateURL('faucet_sku', '<t t-esc='card['faucet_sku']'/>')">
                    <strong><t t-esc="card['faucet']"/></strong><br/>
                    <small><t t-esc="card['faucet_sku']"/></small>
                  </button>
                </div>
              </t>
            </div>
          </div>
        </t>

      </div>

      <script>
        // Update the URL without reloading the page
        function updateURL(param, value) {
          const urlParams = new URLSearchParams(window.location.search);

          // Ensure special characters are safely encoded
          const encodedValue = encodeURIComponent(value);

          // Set the parameter with the new value or remove it if empty
          if (encodedValue) {
            urlParams.set(param, encodedValue);  // Ensure encoding
          } else {
            urlParams.delete(param);
          }

          // Update the URL in the browser without reloading the page
          window.history.pushState({}, '', '?' + urlParams.toString());
        }
      </script>

    </t>
  </template>
</odoo>
