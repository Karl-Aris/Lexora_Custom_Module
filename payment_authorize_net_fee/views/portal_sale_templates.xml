<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <template id="portal_sale_page_no_double_payment" inherit_id="sale_portal.portal_my_sale">
        <xpath expr="//div[@id='portal_sale_content']/../div[contains(@class,'d-flex') and contains(@class,'justify-content-center')]" position="replace">
            <div t-if="sale_order._has_to_be_signed() or sale_order._has_to_be_paid()" class="d-flex justify-content-center gap-1 d-print-none">
                <t t-if="sale_order._has_to_be_signed()">
                    <div class="col-sm-auto mt8">
                        <a role="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalaccept" href="#">
                            <i class="fa fa-check"/>
                            <t t-if="sale_order._has_to_be_paid()"> Sign &amp; Pay</t>
                            <t t-else=""> Accept &amp; Sign</t>
                        </a>
                    </div>
                    <div class="col-sm-auto mt8">
                        <a role="button" class="btn btn-secondary" href="#discussion">
                            <i class="fa fa-comment"/> Feedback
                        </a>
                    </div>
                    <div class="col-sm-auto mt8">
                        <a role="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#modaldecline" href="#">
                            <i class="fa fa-times"/> Reject
                        </a>
                    </div>
                </t>

                <t t-elif="sale_order._has_to_be_paid() and not (sale_order.get_portal_last_transaction() and sale_order.get_portal_last_transaction().state in ['pending','done'])">
                    <div class="col-sm-auto mt8">
                        <a role="button" data-bs-toggle="modal" data-bs-target="#modalaccept" href="#"
                           t-att-class="'%s' % ('btn btn-light' if sale_order.transaction_ids else 'btn btn-primary')">
                            <i class="fa fa-check"/> 
                            <t t-if="not sale_order.signature">Accept &amp; Pay</t>
                            <t t-else="">Pay Now</t>
                        </a>
                    </div>
                </t>

                <t t-elif="sale_order.get_portal_last_transaction() and sale_order.get_portal_last_transaction().state in ['pending','done']">
                    <div class="alert alert-info mt8">
                        <i class="fa fa-info-circle"/> Payment already in progress or completed.
                    </div>
                </t>
            </div>
        </xpath>
    </template>
</odoo>
